# Bluetooth Overlay Configuration (Without FOTA)
# Project: LoRa P2P Encrypted Communication
# Board: Seeed XIAO nRF54L15
#
# This overlay adds Bluetooth Low Energy WITHOUT FOTA/MCUboot support.
# Use this for immediate testing when J-Link hardware is not available.
#
# Build command: west build --no-sysbuild ... -DEXTRA_CONF_FILE="overlay-bt-no-fota.conf"

# ==============================================================================
# Bluetooth Core Configuration
# ==============================================================================

CONFIG_BT=y
CONFIG_BT_PERIPHERAL=y

# Device name shown during Bluetooth scanning
CONFIG_BT_DEVICE_NAME="LoRa_P2P"

# Allow device name to be readable without pairing
CONFIG_BT_DEVICE_NAME_GATT_WRITABLE=n

# ==============================================================================
# Security: Pairing and Bonding Support
# ==============================================================================

# Enable pairing/bonding support for secure connections
CONFIG_BT_SMP=y
CONFIG_BT_BONDABLE=y

# NOTE: Security level (1-4) is set at RUNTIME via bt_conn_set_security()
#       Your application can call bt_conn_set_security(conn, BT_SECURITY_L3)
#       to require authenticated pairing with encryption.

# ==============================================================================
# Stack Size Adjustments for BT + LoRa + Crypto
# ==============================================================================

# Increase main thread stack (Bluetooth + LoRa + Crypto operations)
# Already set in prj.conf to 8192, but we override here for clarity
CONFIG_MAIN_STACK_SIZE=8192

# Increase system workqueue stack (BT events + LoRa DIO1 interrupts)
CONFIG_SYSTEM_WORKQUEUE_STACK_SIZE=4096

# Increase idle stack for cleanup operations
CONFIG_IDLE_STACK_SIZE=1024

# ==============================================================================
# Memory Optimization
# ==============================================================================

# Optimize heap size for BT + LoRa + Crypto
CONFIG_HEAP_MEM_POOL_SIZE=16384

# Number of Bluetooth connections (1 for testing with phone)
CONFIG_BT_MAX_CONN=1

# ==============================================================================
# Bluetooth Connection Parameters (Optional - Defaults are Good)
# ==============================================================================

# NOTE: These parameters are connection interval preferences.
#       Values are in 1.25ms units (e.g., 6 = 7.5ms, 40 = 50ms)
#       Zephyr defaults: min=24 (30ms), max=40 (50ms), latency=0, timeout=42 (420ms)

# Uncomment for faster connection intervals (7.5ms - 15ms):
# CONFIG_BT_PERIPHERAL_PREF_MIN_INT=6
# CONFIG_BT_PERIPHERAL_PREF_MAX_INT=12
# CONFIG_BT_PERIPHERAL_PREF_LATENCY=0
# CONFIG_BT_PERIPHERAL_PREF_TIMEOUT=40

# ==============================================================================
# Bluetooth Advertising
# ==============================================================================

# NOTE: Advertising is automatically enabled when CONFIG_BT_PERIPHERAL=y
#       Advertising intervals are set at RUNTIME via bt_le_adv_start()
#       There are NO Kconfig options for advertising intervals.

# ==============================================================================
# Logging Adjustments
# ==============================================================================

# Reduce Bluetooth log spam (keep warnings and errors only)
CONFIG_BT_LOG_LEVEL_WRN=y

# ==============================================================================
# What's NOT Included (Compared to overlay-bt-dfu.conf)
# ==============================================================================
#
# This overlay does NOT include:
# - MCUmgr (Simple Management Protocol)
# - FOTA/DFU support
# - CONFIG_NCS_SAMPLE_MCUMGR_BT_OTA_DFU
# - Image management
#
# These features require MCUboot bootloader and KMU provisioning (J-Link).
# Use overlay-bt-dfu.conf when J-Link hardware is available.
#
# ==============================================================================
